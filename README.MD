# Hikari —— zkLogin for Starknet

Hikari is a zkLogin scheme for Starknet that simplifies the onboarding process using Web2 credentials through zero-knowledge proof technology. It allows users to set up and recover wallets with one click while keeping Web2 and on-chain identities separate. Supported by Starknet Foundation, Hikari enhances the wallet experience by bridging security and convenience, enabling seamless and secure access to the Starknet ecosystem.

## Directory Descriptions

- `contract`: Cairo contract.

  - `zk_account`: Account Contract
- `circom`:

  - `/build`: Stores files generated by circuit compilation, including proving keys, verification keys, r1cs, witness, etc.
  - `/circuits`: Key circuit files.

    - `/circuits/ptau`: bn128 Ptau files, used for the circuit setup phase tau ceremony.
  - `/script`: Contains Node.js scripts `testJWT.js` and `outputClaim.js`, used to generate the circuit input file `/shell/testJWT_verify.json` and to read the circuit output file `/build/testJWT_verify/public.json`.
  - `/shell`: Contains shell scripts for compiling the circuit, `testJWT_verify.sh`, and the circuit input file `testJWT_verify.json`.
  - `/src`: Auxiliary Node.js script execution.

## Project Circom Testing Steps

0. Install Node.js and the [circom environment](https://docs.circom.io/getting-started/installation/#installing-circom).
1. In the command line, run:

   ```sh
   npm install
   ```

   This will download the necessary libraries for the Node.js scripts.
2. Download the Ptau file from [SnarkJS](https://github.com/iden3/snarkjs#:~:text=and%20verification%20keys.-,NOTE,-Ptau%20files%20for) and store it in `/circuits/ptau`, updating the corresponding Ptau filename in `shell/testJWT_verify.sh`. It is recommended to download the Ptau file with a power of 25 for this circuit.
3. Replace the `token` value in `script/testJWT.js` with the credentials JWT for this test.
4. In the command line, run:

   ```sh
   node script/testJWT.js
   ```

   This will generate the circuit input file `/shell/testJWT_verify.json`.
5. Navigate to the `/shell` directory and run the shell script:

   ```sh
   cd /shell
   ./testJWT_verify.sh
   ```

   This command takes a while to run. Once completed, the Solidity verification contract `DID_Verifier.sol` and the circuit output `public.json` can be found in `/build/testJWT_verify`.
6. Use `script/outputClaim.js` to verify whether the circuit output includes the expected JWT fields.

   In the command line, run:

   ```sh
   node script/outputClaim.js
   ```

   The script will read `build/testJWT_verify/public.json` and output the `exp` (to check if the JWT is expired) and `jti` (a unique JWT identifier to prevent double-spending) fields from the JWT.

   Sample script output:

   ```sh
   Parsed Data: [
   '0', '0', '0', '0', '0', '0', '0', '0', '0', '0',
   '0', '0', '0', '0', '0', '0', '0', '0', '0', '0',
   '0', '0', '0', '107313821946879046362071377559359715801292290208334',
   '147472455246950168194850003601779804808992636932615958668495428240029272685',
   '159488444598703593911218515767279039812489670958227460173539536221001111382',
   '193203855455813000744135277308188662308829639846681803973847500005383864320',
   '0', '0', '0', '0', '0', '0', '0'
   ]
   masked ImV4cCI6MTcxNzQwMjU2NSwianRpIjoiYTA5NGEzMjY0ZmJmMTJmZDk2ZTFkZjZkODFiZmFlZjg3NDY5NWVmYyJ9
   claims [
   '"exp":1717402565,"jti":"a094a3264fbf12fd96e1df6d81bfaef874695efc"}'
   ]
   ```

   The output fields can be changed in `script/testJWT.js`.

## Circuit Assumptions

- The length of any user-generated JWT should be the same, and the length of the same fields in different JWT plaintexts should be equal.

## References

- [snark-jwt-verify](https://github.com/TheFrozenFire/snark-jwt-verify)
- [rooch](https://github.com/rooch-network/rooch)

### P.S.

The directory `/build/testJWT_verify/` already contains the public output `public.json` and verification contract from the last test.
